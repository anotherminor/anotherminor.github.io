{{ define "main" }}
{{ $taxonomy := .Data.Plural }}
{{ $term := .Data.Term }}
{{ $pages := .Pages.ByDate.Reverse }}

<section class="page-hero page-hero--term page-hero--{{ $taxonomy | urlize }}" data-pagefind-ignore>
  <p class="page-hero__eyebrow">
    {{ if eq $taxonomy "categories" }}category{{ else if eq $taxonomy "tags" }}tag{{ else if eq $taxonomy "formats"
    }}format{{ else }}term{{ end }}
  </p>
  <h1 class="page-hero__title">{{ with index .Site.Params.categoryTitles $term }}{{ . }}{{ else }}{{ $.Title }}{{ end }}
  </h1>
  <p class="page-hero__lede">
    {{ with index .Site.Params.categoryDescriptions $taxonomy }}
    {{ if reflect.IsMap . }}
    {{ with index . $term }}{{ . }}{{ end }}
    {{ else }}
    {{ . }}
    {{ end }}
    {{ end }}
  </p>
</section>

{{ if eq $taxonomy "categories" }}
{{ $pager := .Paginate $pages 5 }}
<section class="stream-layout" aria-label="Category posts">
  {{ range $i, $p := $pager.Pages }}
  {{ if gt $i 0 }}<div class="stream-divider" aria-hidden="true"></div>{{ end }}
  {{ partial "post-card-full.html" (dict "page" $p "forceFullBody" true) }}
  {{ end }}
</section>
{{ partial "pagination.html" . }}
{{ else if eq $taxonomy "tags" }}
{{ $pager := .Paginate $pages 20 }}
<section class="card-list card-list--compact" aria-label="Tag posts">
  {{ range $pager.Pages }}
  {{ partial "post-card-summary.html" . }}
  {{ end }}
</section>
{{ partial "pagination.html" . }}
{{ else if eq $taxonomy "formats" }}
{{ $pager := .Paginate $pages 20 }}
<section class="format-list" aria-label="Format posts">
  {{ range $pager.Pages }}
  {{ partial "post-card-format.html" (dict "page" . "term" $term) }}
  {{ end }}
</section>
{{ partial "pagination.html" . }}
{{ else }}
{{ $pager := .Paginate $pages 20 }}
<section class="card-list" aria-label="Posts">
  {{ range $pager.Pages }}
  {{ partial "post-card-summary.html" . }}
  {{ end }}
</section>
{{ partial "pagination.html" . }}
{{ end }}
{{ end }}