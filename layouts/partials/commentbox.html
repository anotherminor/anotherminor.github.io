{{ $c := .Site.Params.commentbox }}
{{ $enabled := and $c $c.enabled (eq .Section "posts") (ne (.Params.comments | default true) false) }}
{{ if $enabled }}
<section class="discussion-panel" aria-labelledby="comments-title" data-pagefind-ignore>
  <div class="discussion-panel__head">
    <h2 id="comments-title">Discussion</h2>
    <p>Powered by commentbox.io</p>
  </div>
  {{ if $c.projectId }}
    <div class="commentbox" id="commentbox"></div>
    <script src="https://unpkg.com/commentbox.io/dist/commentBox.min.js" defer></script>
    <script>
      window.addEventListener('DOMContentLoaded', function () {
        if (typeof commentBox !== 'function') return;
        commentBox({{ $c.projectId | jsonify }});
      });
    </script>
  {{ else }}
    <p class="muted">commentbox.io를 활성화하려면 `hugo.yaml`의 `params.commentbox.projectId`를 채우세요.</p>
  {{ end }}
</section>
{{ end }}
